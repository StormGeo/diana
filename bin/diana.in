#!/bin/sh
set -x

input=$0
prefix="@prefix@"
etcdir="@sysconfdir@"

export DIANADIR=$prefix

debugger="gdb"
ulimit -c 100000000000

gw=`route | grep default | awk '{print $2}' `

case "$gw" in
    vpv*)   region="VV" ;;
    vnn*)   region="VNN" ;;
    vtk*)   region="VTK" ;;
      *)   region="VA";;
esac

home=$HOME/.diana
test -d $home || mkdir $home
test -d $home/work  || mkdir $home/work


setup=$etcdir/diana/@PVERSION@/diana.setup-${region}
test -r $setup || setup=$etcdir/diana/diana.setup-${region}

test -e $home/diana.setup && setup=$home/diana.setup


cd $home

rm core* 1>/dev/null 2>&1
test -s dbxresult  && mv -f dbxresult dbxresult.old
test -s mail.core  && mv -f mail.core mail.core.old

# remove old lpr print files, left after failure...
find . -name "prt_????-??-??_??:??:??.ps" -mtime +1 -exec rm {} \;

# create a logfile with all output in /tmp
random=`date +%N`
logfile=/tmp/diana-$random.log

CATCHCRASH="/usr/bin/catchcrash"
EXE="$prefix/bin/diana.bin-@PVERSION@ \
    -s $setup \
    -T "diana-@PVERSION@" \
    -p \
    -style=cleanlooks \
    $@"

if test -x "$CATCHCRASH"; then
  exec "$CATCHCRASH" --mail-to lisbethb@met.no --subject DIANA_CRASH -- $EXE
else
  exec $EXE
fi 


exit
