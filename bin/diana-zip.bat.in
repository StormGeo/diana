:: $Id$
@echo off

set zipfile=@prefix@/diana-%1-win32.zip
set checkfile=@prefix@/bin/diana.bin.exe

:checkfile
if exist %checkfile% goto checkqt
echo.I can't find %checkfile%!
goto end

:checkqt
if exist @prefix@/bin/QtCore4.dll goto :askuser
echo.WARNING: I can't find Qt in @prefix@/bin!
echo.The user will have to make sure the Qt DLLs are in PATH
echo.before running Diana.
echo.

:askuser
echo.This will create %zipfile%
echo.from selected contents of @prefix@
set /p yesno=Continue? (y/n)
if [%yesno%]==[y] goto create
echo.OK, I won't!
goto end

:create
strip @prefix@/bin/bdiana.exe
zip -9rv %zipfile% @prefix@/bin/bdiana.exe
strip @prefix@/bin/bdiana.bin.exe
zip -9rv %zipfile% @prefix@/bin/diana.bin.exe
zip -9rv %zipfile% @prefix@/bin/diana.bat
zip -9rv %zipfile% @prefix@/bin/Qt*.dll
zip -9rv %zipfile% @prefix@/etc
zip -9rv %zipfile% @prefix@/share/applications
zip -9rv %zipfile% @prefix@/share/diana
zip -9rv %zipfile% @prefix@/share/doc/diana
zip -9rv %zipfile% @prefix@/share/pixmaps
zip -9rv %zipfile% @prefix@/share/grib_api/definitions
zip -9rv %zipfile% @prefix@/share/proj
zip -9rv %zipfile% @prefix@/copyright
goto end

:end
