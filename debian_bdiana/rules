#!/usr/bin/make -f
# -*- makefile -*-

%:
	dh $@ --parallel

# ensure that the executable searches for libraries under the /opt/qt4-headless prefix
confflags += LDFLAGS="-Wl,-rpath=/opt/qt4-headless/lib"

.PHONY: override_dh_auto_configure
override_dh_auto_configure:
	./autogen.sh
	./configure $(confflags) \
	    --disable-silent-rules \
	    --prefix=/usr --sysconfdir=/etc --localstatedir=/var \
	    --enable-obs-bufr \
	    --with-geotiff \
	    --with-qt4=/opt/qt4-headless \
	    --with-qt4-includedir=/opt/qt4-headless/include \
	    --with-qt4-libdir=/opt/qt4-headless/lib \
	    --with-qmake=/opt/qt4-headless/bin/qmake \
	    --with-moc=/opt/qt4-headless/bin/moc \
	    --with-rcc=/opt/qt4-headless/bin/rcc \
	    --with-uic=/opt/qt4-headless/bin/uic \
	    --with-lupdate=/opt/qt4-headless/bin/lupdate \
	    --with-lrelease=/opt/qt4-headless/bin/lrelease \
	    --disable-gui \
	    --enable-perl

.PHONY: override_dh_auto_test
override_dh_auto_test:
	if dh_auto_test; then \
	  echo "dh_auto_test was successful" ; \
	else \
	  make -C test display-testsuite-logs ; \
	  false ; \
	fi

.PHONY: override_dh_strip
override_dh_strip:
	dh_strip --dbg-package=bdiana-@METNO_VERSION@-dbg
